<html>
    <head>
        <title>Track time</title>
        <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js'></script>
        <style type='text/css'>
            td.timediv {
                text-align: center;
                background: #cca;
            }

            td.timediv:hover {
                background: #ddb;
                cursor: pointer;
            }

            td.timediv:active {
                background: #cca;
            }

            table.timedivs {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <table id='timetable' class='timedivs'>
            <tbody>
            </tbody>
        </table>
        <script>
            var time = {
                    days: [
                        {
                            timedivs: [
                                {
                                    name: 'Functional Work',
                                    duration: 0
                                },
                                {
                                    name: 'Develop/Config',
                                    duration: 0
                                }
                            ]
                        }
                    ]
                },

                day,
                row,
                td,
                timediv,
                i,j,
                current,
                currentData;

            for (i = 0; i < time.days.length; ++i) {
                day = time.days[i];
                row = $(document.createElement('tr'));
                $('#timetable tbody').append(row);
                for (j = 0; j < day.timedivs.length; ++j) {
                    timediv = day.timedivs[j];
                    td = $(document.createElement('td'));
                    td.data(timediv);
                    td.addClass('timediv');
                    td.append($(document.createElement('div')).addClass('timediv-label').html(timediv.name));
                    td.append($(document.createElement('div')).addClass('timediv-time').html(timediv.duration));
                    row.append(td);
                }
            }

            $('.timediv').live('click', function () {
                if (current !== undefined && current.id === $(this).id) {
                    current = undefined;
                } else {
                    current = $(this);
                    currentData = current.data();
                    currentData.lastTime = (new Date()).getTime();
                    current.data(currentData);
                }
            });

            function update() {
                if (current) {
                    currentData = current.data();
                    currentData.duration = currentData.duration + ((new Date()).getTime() - currentData.lastTime);
                    currentData.lastTime = (new Date()).getTime();
                    current.data(currentData);
                    current.children('.timediv-time').html(currentData.duration/1000);
                }
                setTimeout(update, 1000);
            }

            update();
        </script>
    </body>
</html> 
